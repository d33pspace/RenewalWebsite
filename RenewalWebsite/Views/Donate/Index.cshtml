@using System.Globalization
@using RenewalWebsite.Services
@using Microsoft.AspNetCore.Mvc.Localization
@model RenewalWebsite.Models.DonationViewModel

@inject IViewLocalizer Localizer
@inject ICurrencyService CurrencyService

@{
    ViewData["Title"] = Localizer["Donate"];
    var currency = CurrencyService.GetCurrent();
    var language = CurrencyService.GetCurrentLanguage();
    double baseAmountCNY = 15;
    double baseAmountUSD = 2.19;
}

<div class="row">

    <div class="col-lg-6 offset-lg-0 offset-md-2 col-md-8 offset-sm-1">
        <img src="https://www.renewal365.org/images/home/slide-donate_springrestock.jpeg" class="figure-img img-fluid" alt="donate page image">
        <figcaption class="figure-caption caption chinese">
            <!--@Localizer["Every"]
            @if (currency.Name.Contains("zh"))
            {
                <span>@baseAmountCNY.ToString("C", currency)</span>
            }
            else
            {
                <span>@baseAmountUSD.ToString("C", currency)</span>
            }
            @Localizer["you give today will provide a hot meal, shower and change of clothes for a homeless man or woman."]-->
            @Localizer["We need new clothes for trainees who are looking for jobs. Stocks of food and dry goods are also running low."]
        </figcaption>
    </div>

    <div class="col-lg-6 offset-lg-0 offset-md-2 col-md-8 offset-sm-1">
        <h2>@Localizer["Help restock our supplies of food and clothing for new trainees"]</h2>
		
		<p>@Localizer["Stocks of food, dry goods and our clothing supplies have slowly depleted over the COVID lockdown, and we need to restock now. Our residential program is once again open to new trainees and more people are seeking urgent help!"]</p>

        @if (currency.Name.Contains("en"))
        {
            <form asp-controller="Donate" asp-action="Create">

                <div asp-validation-summary="All" class="text-danger"></div>
                <div id="textMainMessage" class="text-danger" style="display:none;">
                    <ul>
                        <li id="textMainErrorMessage"></li>
                    </ul>
                </div>
                <div class="form-group" style="overflow:inherit;">
                    <div class="input-group">
                        <label class="mtp-auto">@Localizer["I would like to make a gift of:"]</label>
                        @*<label class="mtp-auto">
                                @Localizer["I would like to make a"]&nbsp;
                            </label>
                            <div class="box">
                                <select asp-for="CycleId" class="wide select-font" style="min-width:120px; max-width:120px;border-radius:0.25rem;"
                                        asp-items="@Model.DonationCycles"></select>
                            </div>&nbsp;

                            <label class="mtp-auto">@Localizer["gift of:"]</label>*@
                    </div>
                </div>
                <input type="hidden" id="Reason" name="Reason" />
                <input type="hidden" id="IsCustom" name="IsCustom" />
                <input type="hidden" id="DonationAmount" name="DonationAmount" />
                <input type="hidden" id="CycleId" name="CycleId" />
                <ul class="list-unstyled rmb-options mb-5">
                    <li> <input id="SelectedAmount" name="SelectedAmount" type="radio" value="1" data-value="false" checked="checked" data-donation-value="14.50" data-reason="For most urgent needs" /><strong>@CurrencyService.GetSymbol(currency)14.0</strong> @Localizer["resupplies food and clothes for one day’s training"]</li>
                    <li> <input id="SelectedAmount" name="SelectedAmount" type="radio" value="2" data-value="false" data-donation-value="29.00" data-reason="For most urgent needs" /><strong>@CurrencyService.GetSymbol(currency)29.00</strong> @Localizer["provides food, clothing and shelter for two day’s training"]</li>
                    <li> <input id="SelectedAmount" name="SelectedAmount" type="radio" value="6" data-value="false" data-donation-value="101.50" data-reason="For most urgent needs" /><strong>@CurrencyService.GetSymbol(currency)101.50</strong> @Localizer["provides food, clothing and shelter for a week’s training"]</li>
					<li> <input id="SelectedAmount" name="SelectedAmount" type="radio" value="3" data-value="false" data-donation-value="435.00" data-reason="For most urgent needs" /><strong>@CurrencyService.GetSymbol(currency)435.00</strong> @Localizer["provides food, clothing and shelter for a months’ training"]</li>
                    <li>
                        <div class="input-group">
                            <input id="SelectedAmount" name="SelectedAmount" type="radio" value="4" class="rb-align" data-value="true" data-reason="for a hot meals, job training, or any current need" onclick="setFocus(this)" /><strong>@CurrencyService.GetSymbol(currency)</strong>
                            <input type="text" id="CustomAmount" name="CustomAmount" onfocus="checkSelection()" class="form-control" style="height:38px;" /> @Localizer["to help as many people as I can."]
                        </div>
                    </li>
                </ul>
                <input type="checkbox" id="RepeateCycle" value="1" />&nbsp; @Localizer["I want my gift to repeat automatically every month."]
                <div class="clearfix mt-3 mb-3">
                    <button id="btnSave" class="btn btn-secondary" type="button" onclick="checkAmount();">@Localizer["DONATE WITH CREDIT OR DEBIT CARD NOW"]&nbsp;<i class="arrow right-arrow"></i></button>
                    <button id="btnSaveFinal" class="btn btn-secondary hide" type="submit">@Localizer["DONATE WITH CREDIT OR DEBIT CARD NOW"]&nbsp;<i class="arrow right-arrow"></i></button>
                </div>
                <p>@await Html.PartialAsync("_CurrencyTogglePartial")</p>
            </form>
        }
        else
        {
            <ul class="list-unstyled gift-options">
                <li><strong>@CurrencyService.GetSymbol(currency)100</strong> @Localizer["resupplies food and clothes for one day’s training"]</li>
                <li><strong>@CurrencyService.GetSymbol(currency)200</strong> @Localizer["provides food, clothing and shelter for two day’s training"]</li>
				<li><strong>@CurrencyService.GetSymbol(currency)700</strong> @Localizer["provides food, clothing and shelter for a week’s training"]</li>
				<li><strong>@CurrencyService.GetSymbol(currency)3000</strong> @Localizer["provides food, clothing and shelter for a months’ training"]</li>
                <li>@Localizer["An amount of my choice to help as many people as I can."]</li>
            </ul>
            <div class="clearfix mt-3 mb-3">
                <a class="btn btn-secondary" target="_blank" href="https://yoopay.cn/pay/renewal365">@Localizer["DONATE NOW USING WECHAT OR ALIPAY"] <i class="arrow right-arrow"></i></a>
            </div>

            <p class="m-tb-15">@await Html.PartialAsync("_CurrencyTogglePartial")</p>
        }
    </div>

</div>
<script type="text/javascript">

    $(document).ready(function () {
        $("#CycleId").val(4);
        //$("#CycleId").prop('selectedIndex', 3);
        //$('select').niceSelect();
    });

    function checkAmount() {
        var item = $('input[name=SelectedAmount]:checked').val();
        if (item == "4") {
            if ($('#CustomAmount').val() == "") {
                $('#textMainMessage').show();
                $('#textMainErrorMessage').text('@Localizer["Amount is required."]');
                $('#CustomAmount').focus();
                return;
            }
            else {
                var finalValue = parseFloat($('#CustomAmount').val());
                var format = /[a-zA-Z!@@#$%^&*()_+\-=\[\]{};':"\\|,<>\/?~`]/;
                if (isNaN(finalValue) || finalValue == 0 || format.test($('#CustomAmount').val())) {
                    $('#textMainMessage').show();
                    $('#textMainErrorMessage').text('@Localizer["Please enter a valid amount."]');
                    $('#CustomAmount').focus();
                    return;
                }
            }

            $('#DonationAmount').val($('#CustomAmount').val());
        }
        else {
            var value = $('input[name=SelectedAmount]:checked').data('donation-value');
            $('#DonationAmount').val(value);
        }

        var reason = $('input[name=SelectedAmount]:checked').data('reason');
        $('#Reason').val(reason);

        var iscustom = $('input[name=SelectedAmount]:checked').data('value');
        $('#IsCustom').val(iscustom);
        
        if($("#RepeateCycle").prop("checked") == true){
             $("#CycleId").val($('#RepeateCycle:checked').val());
            }
            else if($("#RepeateCycle").prop("checked") == false){
             $("#CycleId").val(4);
            }
        $('#textMainMessage').hide();
        $('#textMainErrorMessage').text('');
        $("#btnSaveFinal").trigger("click");
    };

    function setFocus(item) {
        $('#CustomAmount').focus();
    };

    function checkSelection() {
        $('[data-value=true]').prop('checked', true);
    };
</script>
